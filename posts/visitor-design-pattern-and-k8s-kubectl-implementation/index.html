<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Visitor design pattern and k8s kubectl implementation" /><meta name="author" content="Jacob Lin" /><meta property="og:locale" content="en" /><meta name="description" content="Visitor pattern A machine learning framework will typically implement its dataset I/O functionality. Data source are usually of different types and format. Say we have 3 kinds of format to parse, namely CSV, text and images. We could have our code implemented like the following:" /><meta property="og:description" content="Visitor pattern A machine learning framework will typically implement its dataset I/O functionality. Data source are usually of different types and format. Say we have 3 kinds of format to parse, namely CSV, text and images. We could have our code implemented like the following:" /><link rel="canonical" href="https://jiahuanglin.xyz/posts/visitor-design-pattern-and-k8s-kubectl-implementation/" /><meta property="og:url" content="https://jiahuanglin.xyz/posts/visitor-design-pattern-and-k8s-kubectl-implementation/" /><meta property="og:site_name" content="Jacob Lin" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-11T21:11:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Visitor design pattern and k8s kubectl implementation" /><meta name="twitter:site" content="@afferentialism" /><meta name="twitter:creator" content="@Jacob Lin" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jacob Lin"},"dateModified":"2022-02-11T21:11:00-05:00","datePublished":"2022-02-11T21:11:00-05:00","description":"Visitor pattern A machine learning framework will typically implement its dataset I/O functionality. Data source are usually of different types and format. Say we have 3 kinds of format to parse, namely CSV, text and images. We could have our code implemented like the following:","headline":"Visitor design pattern and k8s kubectl implementation","mainEntityOfPage":{"@type":"WebPage","@id":"https://jiahuanglin.xyz/posts/visitor-design-pattern-and-k8s-kubectl-implementation/"},"url":"https://jiahuanglin.xyz/posts/visitor-design-pattern-and-k8s-kubectl-implementation/"}</script><title>Visitor design pattern and k8s kubectl implementation | Jacob Lin</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Jacob Lin"><meta name="application-name" content="Jacob Lin"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Jacob Lin</a></div><div class="site-subtitle font-italic">Software Engineer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/jiahuanglin" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/afferentialism" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jiahuanglin27','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Visitor design pattern and k8s kubectl implementation</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Visitor design pattern and k8s kubectl implementation</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1644631860" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 11, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> Jiahuang(Jacob) Lin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1080 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><h2 id="visitor-pattern"><span class="mr-2">Visitor pattern</span><a href="#visitor-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A machine learning framework will typically implement its dataset I/O functionality. Data source are usually of different types and format. Say we have 3 kinds of format to parse, namely CSV, text and images. We could have our code implemented like the following:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Parser</span> <span class="o">{</span>

  <span class="kd">protected</span> <span class="nc">String</span> <span class="n">filepath</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Parser</span><span class="o">(</span><span class="nc">String</span> <span class="n">filepath</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">filepath</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">abstract</span> <span class="nc">Dataset</span> <span class="nf">parse</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CsvParser</span> <span class="kd">extends</span> <span class="nc">Parser</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">parse</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">//...</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TextParser</span> <span class="kd">extends</span> <span class="nc">Parser</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">parse</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">//...</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImageParser</span> <span class="kd">extends</span> <span class="nc">Parser</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">parse</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">//...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>The disadvantage of this approach is that data sources can be in many different formats, and the framework needs to provide additional I/O support for each data source. We already have 3 classes with 3 different formats and one parsing functionality. If the framework also needs to provide serialization, compression, and transformation for each output data format, then even with only three data formats, we would have 3 * 4 = 12 classes. Given that the number of data source format can be big, the above implementation doesn’t look like a scalable solution.</p><p>If we could decouple the data format from the I/O function, then the total number of classes would be an addition result rather than a multiplication result. The implementation looks like the following:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">DataFile</span> <span class="o">{</span>

  <span class="kd">protected</span> <span class="nc">String</span> <span class="n">filepath</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">DataFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">filepath</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">filepath</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CsvFile</span> <span class="kd">extends</span> <span class="nc">DataFile</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">CsvFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">filepath</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">filepath</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TextFile</span> <span class="kd">extends</span> <span class="nc">DataFile</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">TextFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">filepath</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">filepath</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImageFile</span> <span class="kd">extends</span> <span class="nc">DataFile</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">ImageFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">filepath</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">filepath</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataParser</span> <span class="o">{</span>
  <span class="c1">// return a parsed dataset object</span>
  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">parse</span><span class="o">(</span><span class="nc">CsvFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">parse</span><span class="o">(</span><span class="nc">TextFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">parse</span><span class="o">(</span><span class="nc">ImageFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataTransformer</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">transform</span><span class="o">(</span><span class="nc">CsvFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">transform</span><span class="o">(</span><span class="nc">TextFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">transform</span><span class="o">(</span><span class="nc">ImageFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>However, the above code doesn’t compile in Java. The implementation makes an inheritance relationship with the <code class="language-plaintext highlighter-rouge">DataFile</code> class and then uses overloaded functions in the <code class="language-plaintext highlighter-rouge">Parser</code>/<code class="language-plaintext highlighter-rouge">Serializer</code> class to handle different file types. But because the binding time of Java polymorphism and function overloading is different, the compiler doesn’t know what the parameters passed in the end during compile time, so it reports an error.</p><p>We can apply visitor pattern like the following:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">DataFile</span> <span class="o">{</span>

  <span class="kd">protected</span> <span class="nc">String</span> <span class="n">filepath</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">DataFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">filepath</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">filepath</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="nc">Visitor</span> <span class="n">visitor</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CsvFile</span> <span class="kd">extends</span> <span class="nc">DataFile</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">CsvFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">filepath</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">filepath</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="nc">Visitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">visitor</span><span class="o">.</span><span class="na">visit</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TextFile</span> <span class="kd">extends</span> <span class="nc">DataFile</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">TextFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">filepath</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">filepath</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="nc">Visitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">visitor</span><span class="o">.</span><span class="na">visit</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="c1">// ...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImageFile</span> <span class="kd">extends</span> <span class="nc">DataFile</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">ImageFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">filepath</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">filepath</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="nc">Visitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">visitor</span><span class="o">.</span><span class="na">visit</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="c1">// ...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Visitor</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">visit</span><span class="o">(</span><span class="nc">CsvFile</span> <span class="n">file</span><span class="o">);</span>
  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">visit</span><span class="o">(</span><span class="nc">TextFile</span> <span class="n">file</span><span class="o">);</span>
  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">visit</span><span class="o">(</span><span class="nc">ImageFile</span> <span class="n">file</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataParser</span> <span class="kd">implements</span> <span class="nc">Visitor</span> <span class="o">{</span>
  <span class="c1">// return a parsed dataset object</span>
  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">visit</span><span class="o">(</span><span class="nc">CsvFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ... parsing</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">visit</span><span class="o">(</span><span class="nc">TextFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ... parsing</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">visit</span><span class="o">(</span><span class="nc">ImageFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ... parsing</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataTransformer</span> <span class="o">{</span>
  <span class="c1">// return a parsed dataset object</span>
  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">visit</span><span class="o">(</span><span class="nc">CsvFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ... transform</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">visit</span><span class="o">(</span><span class="nc">TextFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ... transform</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Dataset</span> <span class="nf">visit</span><span class="o">(</span><span class="nc">ImageFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ... transform</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="visitor-pattern-in-kubectl"><span class="mr-2">Visitor pattern in Kubectl</span><a href="#visitor-pattern-in-kubectl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">type</span> <span class="n">VisitorFunc</span> <span class="k">func</span><span class="p">(</span><span class="o">*</span><span class="n">Info</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">error</span>

<span class="k">type</span> <span class="n">Visitor</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Visit</span><span class="p">(</span><span class="n">VisitorFunc</span><span class="p">)</span> <span class="kt">error</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">Info</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">Namespace</span>   <span class="kt">string</span>
    <span class="n">Name</span>        <span class="kt">string</span>
    <span class="n">OtherThings</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">info</span> <span class="o">*</span><span class="n">Info</span><span class="p">)</span> <span class="n">Visit</span><span class="p">(</span><span class="n">fn</span> <span class="n">VisitorFunc</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Note that the <code class="language-plaintext highlighter-rouge">Visit()</code> method of the Visitor interface is implemented <code class="language-plaintext highlighter-rouge">for Info</code>, and instead of passing the object to <code class="language-plaintext highlighter-rouge">Visit()</code>, the implementation directly passes the funtion pointer (another form of runtime <code class="language-plaintext highlighter-rouge">overloading</code>).</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="c">// visitors for each field of Info struct</span>

<span class="c">// Name visitor</span>
<span class="k">type</span> <span class="n">NameVisitor</span> <span class="k">struct</span> <span class="p">{</span> 
  <span class="n">visitor</span> <span class="n">Visitor</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">v</span> <span class="n">NameVisitor</span><span class="p">)</span> <span class="n">Visit</span><span class="p">(</span><span class="n">fn</span> <span class="n">VisitorFunc</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span> 
  <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">visitor</span><span class="o">.</span><span class="n">Visit</span><span class="p">(</span>
    <span class="k">func</span><span class="p">(</span><span class="n">info</span> <span class="o">*</span><span class="n">Info</span><span class="p">,</span> <span class="n">err</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"NameVisitor() before call function"</span><span class="p">)</span> 
      <span class="n">err</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> 
      <span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span> 
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"==&gt; Name=%s, NameSpace=%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> 
      <span class="p">}</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"NameVisitor() after call function"</span><span class="p">)</span> 
      <span class="k">return</span> <span class="n">err</span> 
    <span class="p">}</span>
  <span class="p">)</span>
<span class="p">}</span>


<span class="c">// Other visitor</span>
<span class="k">type</span> <span class="n">OtherThingsVisitor</span> <span class="k">struct</span> <span class="p">{</span> 
  <span class="n">visitor</span> <span class="n">Visitor</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">v</span> <span class="n">OtherThingsVisitor</span><span class="p">)</span> <span class="n">Visit</span><span class="p">(</span><span class="n">fn</span> <span class="n">VisitorFunc</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">visitor</span><span class="o">.</span><span class="n">Visit</span><span class="p">(</span>
    <span class="k">func</span><span class="p">(</span><span class="n">info</span> <span class="o">*</span><span class="n">Info</span><span class="p">,</span> <span class="n">err</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"OtherThingsVisitor() before call function"</span><span class="p">)</span> 
      <span class="n">err</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> 
      <span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span> 
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"==&gt; OtherThings=%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">OtherThings</span><span class="p">)</span> 
      <span class="p">}</span> 
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"OtherThingsVisitor() after call function"</span><span class="p">)</span> 
      <span class="k">return</span> <span class="n">err</span>   
    <span class="p">}</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="c">// Log visitor</span>
<span class="k">type</span> <span class="n">LogVisitor</span> <span class="k">struct</span> <span class="p">{</span> 
  <span class="n">visitor</span> <span class="n">Visitor</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">v</span> <span class="n">LogVisitor</span><span class="p">)</span> <span class="n">Visit</span><span class="p">(</span><span class="n">fn</span> <span class="n">VisitorFunc</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">visitor</span><span class="o">.</span><span class="n">Visit</span><span class="p">(</span>
    <span class="k">func</span><span class="p">(</span><span class="n">info</span> <span class="o">*</span><span class="n">Info</span><span class="p">,</span> <span class="n">err</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"LogVisitor() before call function"</span><span class="p">)</span> 
      <span class="n">err</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"LogVisitor() after call function"</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">err</span> 
    <span class="p">}</span>
  <span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="reference"><span class="mr-2">Reference</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://github.com/kubernetes/kubernetes/blob/cea1d4e20b4a7886d8ff65f34c6d4f95efcb4742/staging/src/k8s.io/cli-runtime/pkg/resource/visitor.go">Kubectl source code visitor.go</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/software/'>Software</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/design-pattern/" class="post-tag no-text-decoration" >design pattern</a> <a href="/tags/k8s/" class="post-tag no-text-decoration" >k8s</a> <a href="/tags/java/" class="post-tag no-text-decoration" >Java</a> <a href="/tags/go/" class="post-tag no-text-decoration" >Go</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Visitor+design+pattern+and+k8s+kubectl+implementation+-+Jacob+Lin&url=https%3A%2F%2Fjiahuanglin.xyz%2Fposts%2Fvisitor-design-pattern-and-k8s-kubectl-implementation%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Visitor+design+pattern+and+k8s+kubectl+implementation+-+Jacob+Lin&u=https%3A%2F%2Fjiahuanglin.xyz%2Fposts%2Fvisitor-design-pattern-and-k8s-kubectl-implementation%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fjiahuanglin.xyz%2Fposts%2Fvisitor-design-pattern-and-k8s-kubectl-implementation%2F&text=Visitor+design+pattern+and+k8s+kubectl+implementation+-+Jacob+Lin" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/learning-java-annotations/">Learning Java annotations</a><li><a href="/posts/my-notes-of-reading-effective-c++/">My notes of reading effective C++</a><li><a href="/posts/how-to-shorten-the-url/">How to shorten the url</a><li><a href="/posts/floating-point-number-and-fixed-point-number/">Floating point numbers and fixed point numbers</a><li><a href="/posts/scanline-algorithm/">Scanline algorithm</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/go/">Go</a> <a class="post-tag" href="/tags/server/">server</a> <a class="post-tag" href="/tags/compiler/">compiler</a> <a class="post-tag" href="/tags/framework/">framework</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/graphics/">graphics</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/pub-sub-design-pattern/"><div class="card-body"> <em class="small" data-ts="1639622880" data-df="ll" > Dec 15, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pub-Sub design pattern</h3><div class="text-muted small"><p> Pub-Sub design pattern is usually known as Observer pattern. I personally like to refer this pattern as Pub-Sub which I think better captures the essence of this pattern. In GoF’s book Design Patt...</p></div></div></a></div><div class="card"> <a href="/posts/decorator-design-pattern/"><div class="card-body"> <em class="small" data-ts="1639843920" data-df="ll" > Dec 18, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Decorator design pattern and Java I/O package</h3><div class="text-muted small"><p> The decorator pattern is a way to dynamically add functionality to an instance of an object at runtime. If we want to read data from file with Java, our code will look something like the follo...</p></div></div></a></div><div class="card"> <a href="/posts/chain-of-responsibility-design-pattern/"><div class="card-body"> <em class="small" data-ts="1639976460" data-df="ll" > Dec 20, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Chain of responsibility design pattern</h3><div class="text-muted small"><p> The chain of responsibility design pattern In compiler backend development, we usually will have to run multiple passes on the intermediate representation. Those passes including optimization ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/writing-a-llvm-pass/" class="btn btn-outline-primary" prompt="Older"><p>Writing a LLVM pass</p></a> <a href="/posts/how-to-shorten-the-url/" class="btn btn-outline-primary" prompt="Newer"><p>How to shorten the url</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/jiahuanglin">Jiahuang(Jacob) Lin</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/go/">Go</a> <a class="post-tag" href="/tags/server/">server</a> <a class="post-tag" href="/tags/compiler/">compiler</a> <a class="post-tag" href="/tags/framework/">framework</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/graphics/">graphics</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
