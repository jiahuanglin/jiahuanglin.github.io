<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="How deque is implemented in STL" /><meta name="author" content="Jacob Lin" /><meta property="og:locale" content="en" /><meta name="description" content="A double-ended queue is open at both ends compared to the regular queue. Both push and pop operations can be performed at the head and tail of the queue. Essentially, a double-ended queue is just a queue that supports FIFO insertion and deletion at both ends and semantically does not support random access, insertion and deletion based on subscripts like an array." /><meta property="og:description" content="A double-ended queue is open at both ends compared to the regular queue. Both push and pop operations can be performed at the head and tail of the queue. Essentially, a double-ended queue is just a queue that supports FIFO insertion and deletion at both ends and semantically does not support random access, insertion and deletion based on subscripts like an array." /><link rel="canonical" href="https://jiahuanglin.xyz/posts/how-deque-is-implemented-in-stl/" /><meta property="og:url" content="https://jiahuanglin.xyz/posts/how-deque-is-implemented-in-stl/" /><meta property="og:site_name" content="Jacob Lin" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-17T17:41:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How deque is implemented in STL" /><meta name="twitter:site" content="@afferentialism" /><meta name="twitter:creator" content="@Jacob Lin" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jacob Lin"},"dateModified":"2022-07-14T21:58:54-04:00","datePublished":"2021-12-17T17:41:00-05:00","description":"A double-ended queue is open at both ends compared to the regular queue. Both push and pop operations can be performed at the head and tail of the queue. Essentially, a double-ended queue is just a queue that supports FIFO insertion and deletion at both ends and semantically does not support random access, insertion and deletion based on subscripts like an array.","headline":"How deque is implemented in STL","mainEntityOfPage":{"@type":"WebPage","@id":"https://jiahuanglin.xyz/posts/how-deque-is-implemented-in-stl/"},"url":"https://jiahuanglin.xyz/posts/how-deque-is-implemented-in-stl/"}</script><title>How deque is implemented in STL | Jacob Lin</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Jacob Lin"><meta name="application-name" content="Jacob Lin"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Jacob Lin</a></div><div class="site-subtitle font-italic">Software Engineer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/jiahuanglin" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/afferentialism" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jiahuanglin27','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>How deque is implemented in STL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>How deque is implemented in STL</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1639780860" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 17, 2021 </em> </span> <span> Updated <em class="" data-ts="1657850334" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 14, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> Jiahuang(Jacob) Lin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1553 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>A double-ended queue is open at both ends compared to the regular queue. Both <code class="language-plaintext highlighter-rouge">push</code> and <code class="language-plaintext highlighter-rouge">pop</code> operations can be performed at the head and tail of the queue. Essentially, a double-ended queue is just a queue that supports FIFO insertion and deletion at both ends and semantically does not support random access, insertion and deletion based on subscripts like an array.</p><h3 id="how-to-implement-deque"><span class="mr-2">How to implement deque</span><a href="#how-to-implement-deque" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If we need to implement a fixed-length deque, we just need to allocate an array of size <code class="language-plaintext highlighter-rouge">N</code>. Two indices represent the <code class="language-plaintext highlighter-rouge">head</code> and <code class="language-plaintext highlighter-rouge">tail</code>. When there is an <code class="language-plaintext highlighter-rouge">insertFront()</code> operation, we do <code class="language-plaintext highlighter-rouge">array[(--front+N)%N] = value</code>. This implementation essentially constitutes a circular deque. And the <code class="language-plaintext highlighter-rouge">add()/delete()</code> operations are <code class="language-plaintext highlighter-rouge">O(1)</code> operations since all we need is to move the <code class="language-plaintext highlighter-rouge">head/tail indices</code>. We can even extend this solution to support random access by the element order.</p><p>But the problem with this implementation is that if the deque is of dynamic length, each expansion will require linear time to copy the array.</p><p>Suppose we implement deque in a linked list way. In that case, the <code class="language-plaintext highlighter-rouge">add()/delete()</code> operations are constant time, and we donâ€™t need to consider the expansion of deque because each time we add an element, we only need to allocate one more node in memory. Such implementation looks lovely on the surface, but the problem with linked list is that each node in the chain may be discontinuous in memory. A cache line load may not read exactly the next node, and one main memory lookup is very expensive. Such implementation can lead to a degradation of deque performance.</p><p>Is there a way to implement deque that supports expansion in <code class="language-plaintext highlighter-rouge">O(1)</code>, and also makes use of locality pattern of memory access?</p><h3 id="how-stl-implements-deque"><span class="mr-2">How STL implements deque</span><a href="#how-stl-implements-deque" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In STL, the memory layout of deque composes segments of contiguous space, and the address information of these spaces is stitched together with another array structure. The time complexity of <code class="language-plaintext highlighter-rouge">insertion()</code> and <code class="language-plaintext highlighter-rouge">deletion()</code> at the front and tail is <code class="language-plaintext highlighter-rouge">O(1)</code>. For example, each time we use up an adjacent space, deque will request a new space and link it to the end of its segment space. So deque does not need to pay the high cost of replication and copying every time since we expand it like vector, nor does it need to request memory every time a new node is inserted like a linked list. Deque needs to keep a map to maintain a contiguous segment of memory space, which is called a buffer.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
</pre><td class="rouge-code"><pre><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Ref</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Ptr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">BuffSize</span> <span class="o">=</span> <span class="mi">8</span><span class="p">&gt;</span>
<span class="k">struct</span> <span class="nc">__DequeIterator</span>
<span class="p">{</span>
	<span class="k">typedef</span> <span class="n">T</span><span class="o">**</span>										<span class="n">MapPointer</span><span class="p">;</span>
	<span class="k">typedef</span> <span class="n">__DequeIterator</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">T</span><span class="o">*</span><span class="p">,</span> <span class="n">BuffSize</span><span class="o">&gt;</span>	<span class="n">Iterator</span><span class="p">;</span>
	<span class="k">typedef</span> <span class="n">__DequeIterator</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Ref</span><span class="p">,</span> <span class="n">Ptr</span><span class="p">,</span> <span class="n">BuffSize</span><span class="o">&gt;</span>	<span class="n">Self</span><span class="p">;</span>

	<span class="c1">//typedef __DequeIterator Self;</span>

	<span class="c1">// constructor</span>
	<span class="n">__DequeIterator</span><span class="p">()</span>
	<span class="o">:</span><span class="n">_cur</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
	<span class="p">,</span><span class="n">_first</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
	<span class="p">,</span><span class="n">_last</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
	<span class="p">,</span><span class="n">_node</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
	<span class="p">{}</span>

	<span class="n">__DequeIterator</span><span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">cur</span><span class="p">,</span> <span class="n">MapPointer</span> <span class="n">node</span><span class="p">)</span>
		<span class="o">:</span><span class="n">_cur</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
		<span class="p">,</span><span class="n">_first</span><span class="p">(</span><span class="o">*</span><span class="n">node</span><span class="p">)</span>
		<span class="p">,</span><span class="n">_last</span><span class="p">(</span><span class="n">_first</span> <span class="o">+</span> <span class="n">BuffSize</span><span class="p">)</span>
		<span class="p">,</span><span class="n">_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
	<span class="p">{}</span>
	
	<span class="n">__DequeIterator</span><span class="p">(</span><span class="k">const</span> <span class="n">Iterator</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span>
		<span class="o">:</span><span class="n">_cur</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">_cur</span><span class="p">)</span>
		<span class="p">,</span><span class="n">_first</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">_first</span><span class="p">)</span>
		<span class="p">,</span><span class="n">_last</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">_last</span><span class="p">)</span>
		<span class="p">,</span><span class="n">_node</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">_node</span><span class="p">)</span>
	<span class="p">{}</span>

	<span class="c1">// self increment</span>
	<span class="n">Self</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">++</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="o">++</span><span class="n">_cur</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">_cur</span> <span class="o">==</span> <span class="n">_last</span><span class="p">){</span>
			<span class="n">SetNode</span><span class="p">(</span><span class="n">_node</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">_cur</span> <span class="o">=</span> <span class="n">_first</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">Self</span> <span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Self</span> <span class="n">temp</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
		<span class="o">++</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
	<span class="p">}</span>

  <span class="c1">// self decrement</span>
	<span class="n">Self</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">--</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">_cur</span> <span class="o">==</span> <span class="n">_first</span><span class="p">){</span>
			<span class="n">SetNode</span><span class="p">(</span><span class="n">_node</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">_cur</span> <span class="o">=</span> <span class="n">_last</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="o">--</span><span class="n">_cur</span><span class="p">;</span>
		
		<span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">Self</span> <span class="k">operator</span><span class="o">--</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Self</span> <span class="n">temp</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
		<span class="o">--</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">// comparison</span>
	<span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Self</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span><span class="k">const</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">_cur</span> <span class="o">!=</span> <span class="n">s</span><span class="p">.</span><span class="n">_cur</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Self</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span><span class="k">const</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="n">s</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="c1">// de-reference</span>
	<span class="n">Ref</span> <span class="k">operator</span> <span class="o">*</span><span class="p">()</span><span class="k">const</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="o">*</span><span class="n">_cur</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">Ptr</span> <span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span><span class="k">const</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="o">&amp;</span><span class="p">(</span><span class="k">operator</span><span class="o">*</span><span class="p">());</span>
	<span class="p">}</span>


	<span class="c1">// reset iterator position</span>
	<span class="kt">void</span> <span class="n">SetNode</span><span class="p">(</span><span class="n">MapPointer</span> <span class="n">newNode</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">_node</span> <span class="o">=</span> <span class="n">newNode</span><span class="p">;</span>
		<span class="n">_first</span> <span class="o">=</span> <span class="o">*</span><span class="n">newNode</span><span class="p">;</span>
		<span class="n">_last</span> <span class="o">=</span> <span class="o">*</span><span class="n">newNode</span> <span class="o">+</span> <span class="n">BuffSize</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">T</span><span class="o">*</span> <span class="n">_cur</span><span class="p">;</span>
	<span class="n">T</span><span class="o">*</span> <span class="n">_first</span><span class="p">;</span>
	<span class="n">T</span><span class="o">*</span> <span class="n">_last</span><span class="p">;</span>
	<span class="n">MapPointer</span> <span class="n">_node</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Basically the iterator really has to pay attention to the buffer boudary, which brings us <code class="language-plaintext highlighter-rouge">SetNode()</code> method. Every time when iterator increments/decrements at the boudary, we <code class="language-plaintext highlighter-rouge">SetNode()</code> to next buffer (which also sets up <code class="language-plaintext highlighter-rouge">_first</code> and <code class="language-plaintext highlighter-rouge">_last</code>).</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
</pre><td class="rouge-code"><pre><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">BuffSize</span> <span class="o">=</span> <span class="mi">8</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">Deque</span>
<span class="p">{</span>
	<span class="k">typedef</span> <span class="n">T</span><span class="o">**</span> <span class="n">MapPointer</span><span class="p">;</span>
<span class="nl">public:</span>
	<span class="k">typedef</span> <span class="n">__DequeIterator</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">T</span><span class="o">*</span><span class="p">,</span> <span class="n">BuffSize</span><span class="o">&gt;</span>				<span class="n">Iterator</span><span class="p">;</span>
	<span class="k">typedef</span> <span class="n">__DequeIterator</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">*</span><span class="p">,</span> <span class="n">BuffSize</span><span class="o">&gt;</span>	<span class="n">ConstIterator</span><span class="p">;</span>
	<span class="k">typedef</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">Ref</span><span class="p">;</span>
	<span class="k">typedef</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">ConstRef</span><span class="p">;</span>
<span class="nl">public:</span>
	<span class="c1">//construction</span>
	<span class="n">Deque</span><span class="p">()</span>
		<span class="o">:</span><span class="n">_map</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
		<span class="p">,</span><span class="n">_mapSize</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="p">,</span><span class="n">_size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">assert</span><span class="p">(</span><span class="n">BuffSize</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kt">void</span> <span class="n">PushBack</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">_map</span> <span class="o">||</span> <span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span> <span class="o">==</span> <span class="n">_finish</span><span class="p">.</span><span class="n">_last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>	
			<span class="n">_PushBackAux</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>								
		<span class="k">else</span><span class="p">{</span>
			<span class="o">*</span><span class="p">(</span><span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span><span class="p">)</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
			<span class="o">++</span><span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span><span class="p">;</span>
			<span class="o">++</span><span class="n">_size</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kt">void</span> <span class="n">PushFront</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">_map</span> <span class="o">||</span> <span class="n">_start</span><span class="p">.</span><span class="n">_cur</span> <span class="o">==</span> <span class="n">_start</span><span class="p">.</span><span class="n">_first</span><span class="p">)</span>
			<span class="n">_PushFrontAux</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
		<span class="k">else</span><span class="p">{</span>
			<span class="o">*</span><span class="p">(</span><span class="n">_start</span><span class="p">.</span><span class="n">_cur</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
			<span class="o">--</span><span class="n">_start</span><span class="p">.</span><span class="n">_cur</span><span class="p">;</span>
			<span class="o">++</span><span class="n">_size</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kt">void</span> <span class="n">PopBack</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="o">--</span><span class="n">_finish</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span> <span class="o">==</span> <span class="n">_finish</span><span class="p">.</span><span class="n">_last</span><span class="p">){</span>
			<span class="k">delete</span><span class="p">[]</span> <span class="o">*</span> <span class="p">(</span><span class="n">_finish</span><span class="p">.</span><span class="n">_node</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="o">*</span><span class="p">(</span><span class="n">_finish</span><span class="p">.</span><span class="n">_node</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">_finish</span> <span class="o">==</span> <span class="n">_start</span><span class="p">){</span>
			<span class="k">delete</span><span class="p">[]</span> <span class="n">_map</span><span class="p">;</span>
			<span class="n">_map</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="o">--</span><span class="n">_size</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kt">void</span> <span class="n">PopFront</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="o">++</span><span class="n">_start</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">_start</span><span class="p">.</span><span class="n">_cur</span> <span class="o">==</span> <span class="n">_start</span><span class="p">.</span><span class="n">_first</span><span class="p">){</span>
			<span class="k">delete</span><span class="p">[]</span> <span class="o">*</span> <span class="p">(</span><span class="n">_start</span><span class="p">.</span><span class="n">_node</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="o">*</span><span class="p">(</span><span class="n">_start</span><span class="p">.</span><span class="n">_node</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">_finish</span> <span class="o">==</span> <span class="n">_start</span><span class="p">){</span>
			<span class="k">delete</span> <span class="n">_map</span><span class="p">;</span>
			<span class="n">_map</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="o">--</span><span class="n">_size</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">//Iteration</span>
	<span class="n">Iterator</span> <span class="n">Begin</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">_start</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ConstIterator</span> <span class="n">Begin</span><span class="p">()</span><span class="k">const</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">_start</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">Iterator</span> <span class="n">End</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">_finish</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ConstIterator</span> <span class="n">End</span><span class="p">()</span><span class="k">const</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">_finish</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">//capacity</span>
	<span class="kt">size_t</span> <span class="n">Size</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">_size</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kt">bool</span> <span class="n">Empty</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">_start</span> <span class="o">==</span> <span class="n">_finish</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">T</span><span class="o">&amp;</span> <span class="n">Back</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">!=</span> <span class="n">_size</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span> <span class="o">!=</span> <span class="n">_finish</span><span class="p">.</span><span class="n">_first</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">else</span><span class="p">{</span>
			<span class="n">Iterator</span> <span class="n">it</span><span class="p">(</span><span class="n">_finish</span><span class="p">);</span>
			<span class="o">--</span><span class="n">it</span><span class="p">;</span>
			<span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">_cur</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">T</span><span class="o">&amp;</span> <span class="n">Front</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">!=</span> <span class="n">_size</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">_start</span><span class="p">.</span><span class="n">_cur</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="o">~</span><span class="n">Deque</span><span class="p">()</span> <span class="c1">// destructor to release memory</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">_map</span><span class="p">){</span>
			<span class="n">T</span><span class="o">**</span> <span class="n">cur</span> <span class="o">=</span> <span class="n">_start</span><span class="p">.</span><span class="n">_node</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(;</span> <span class="n">cur</span> <span class="o">!=</span> <span class="n">_finish</span><span class="p">.</span><span class="n">_node</span><span class="p">;</span> <span class="o">++</span><span class="n">cur</span><span class="p">){</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">cur</span><span class="p">){</span>
					<span class="k">delete</span><span class="p">[]</span> <span class="o">*</span> <span class="n">cur</span><span class="p">;</span>
					<span class="o">*</span><span class="n">cur</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">cur</span><span class="p">){</span>
				<span class="k">delete</span><span class="p">[]</span> <span class="o">*</span> <span class="n">cur</span><span class="p">;</span>
				<span class="o">*</span><span class="n">cur</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">delete</span><span class="p">[]</span> <span class="n">_map</span><span class="p">;</span>
			<span class="n">_map</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

<span class="nl">protected:</span>
	<span class="kt">void</span> <span class="n">_PushBackAux</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">_map</span> <span class="o">||</span> <span class="n">_map</span> <span class="o">+</span> <span class="n">_mapSize</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">_finish</span><span class="p">.</span><span class="n">_node</span><span class="p">){</span>
			<span class="kt">size_t</span> <span class="n">newSize</span> <span class="o">=</span> <span class="n">_mapSize</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="n">_mapSize</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">MapPointer</span> <span class="n">temp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">T</span><span class="o">*</span><span class="p">[</span><span class="n">newSize</span><span class="p">];</span>  <span class="c1">// allocate new room</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">newSize</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="o">*</span><span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
			
			<span class="kt">size_t</span> <span class="n">addToNode</span> <span class="o">=</span> <span class="n">_mapSize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>	<span class="c1">//0</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">_mapSize</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="n">temp</span><span class="p">[</span><span class="n">addToNode</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_map</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

			<span class="kt">size_t</span> <span class="n">oldStartNode</span> <span class="o">=</span> <span class="n">_start</span><span class="p">.</span><span class="n">_node</span> <span class="o">-</span> <span class="n">_map</span><span class="p">;</span><span class="c1">//0</span>
			<span class="kt">size_t</span> <span class="n">oldFinishNode</span> <span class="o">=</span> <span class="n">_finish</span><span class="p">.</span><span class="n">_node</span> <span class="o">-</span> <span class="n">_map</span><span class="p">;</span><span class="c1">//0</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">_map</span><span class="p">)</span>
				<span class="k">delete</span><span class="p">[]</span> <span class="n">_map</span><span class="p">;</span>

			<span class="n">_map</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span><span class="p">){</span>
				<span class="n">_start</span><span class="p">.</span><span class="n">SetNode</span><span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="n">addToNode</span> <span class="o">+</span> <span class="n">oldStartNode</span><span class="p">);</span>
				<span class="n">_finish</span><span class="p">.</span><span class="n">SetNode</span><span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="n">addToNode</span> <span class="o">+</span> <span class="n">oldFinishNode</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span><span class="p">{</span>
				<span class="o">*</span><span class="p">(</span><span class="n">_map</span><span class="p">)</span> <span class="o">=</span> <span class="k">new</span> <span class="n">T</span><span class="p">[</span><span class="n">BuffSize</span><span class="p">];</span>

				<span class="n">_finish</span><span class="p">.</span><span class="n">SetNode</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
				<span class="n">_start</span><span class="p">.</span><span class="n">SetNode</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
				<span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_map</span><span class="p">)</span> <span class="o">+</span> <span class="n">BuffSize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
				<span class="n">_start</span><span class="p">.</span><span class="n">_cur</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_map</span><span class="p">)</span> <span class="o">+</span> <span class="n">BuffSize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
				<span class="o">*</span><span class="p">(</span><span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span><span class="o">++</span><span class="p">)</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
				<span class="o">++</span><span class="n">_size</span><span class="p">;</span>
				<span class="n">_mapSize</span> <span class="o">=</span> <span class="n">newSize</span><span class="p">;</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">_mapSize</span> <span class="o">=</span> <span class="n">newSize</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="o">*</span><span class="p">(</span><span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span><span class="p">)</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
		<span class="o">*</span><span class="p">(</span><span class="n">_finish</span><span class="p">.</span><span class="n">_node</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="k">new</span> <span class="n">T</span><span class="p">[</span><span class="n">BuffSize</span><span class="p">];</span>
		<span class="n">_finish</span><span class="p">.</span><span class="n">SetNode</span><span class="p">(</span><span class="n">_finish</span><span class="p">.</span><span class="n">_node</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span> <span class="o">=</span> <span class="n">_finish</span><span class="p">.</span><span class="n">_first</span><span class="p">;</span>
		<span class="o">++</span><span class="n">_size</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">_PushFrontAux</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">_map</span> <span class="o">||</span> <span class="n">_map</span> <span class="o">==</span> <span class="n">_start</span><span class="p">.</span><span class="n">_node</span><span class="p">){</span>
			<span class="kt">size_t</span> <span class="n">newSize</span> <span class="o">=</span> <span class="n">_mapSize</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="n">_mapSize</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">MapPointer</span> <span class="n">temp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">T</span><span class="o">*</span><span class="p">[</span><span class="n">newSize</span><span class="p">];</span>

			<span class="kt">size_t</span> <span class="n">addToNode</span> <span class="o">=</span> <span class="n">_mapSize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">_mapSize</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="n">temp</span><span class="p">[</span><span class="n">addToNode</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_map</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

			<span class="kt">size_t</span> <span class="n">oldStartNode</span> <span class="o">=</span> <span class="n">_start</span><span class="p">.</span><span class="n">_node</span> <span class="o">-</span> <span class="n">_map</span><span class="p">;</span>
			<span class="kt">size_t</span> <span class="n">oldFinishNode</span> <span class="o">=</span> <span class="n">_finish</span><span class="p">.</span><span class="n">_node</span> <span class="o">-</span> <span class="n">_map</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">_map</span><span class="p">)</span>
				<span class="k">delete</span><span class="p">[]</span> <span class="n">_map</span><span class="p">;</span>

			<span class="n">_map</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">_start</span><span class="p">.</span><span class="n">_cur</span><span class="p">){</span>
				<span class="n">_start</span><span class="p">.</span><span class="n">SetNode</span><span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="n">addToNode</span> <span class="o">+</span> <span class="n">oldStartNode</span><span class="p">);</span>
				<span class="n">_finish</span><span class="p">.</span><span class="n">SetNode</span><span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="n">addToNode</span> <span class="o">+</span> <span class="n">oldFinishNode</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span><span class="p">{</span>
				<span class="o">*</span><span class="p">(</span><span class="n">_map</span><span class="p">)</span> <span class="o">=</span> <span class="k">new</span> <span class="n">T</span><span class="p">[</span><span class="n">BuffSize</span><span class="p">];</span>

				<span class="n">_start</span><span class="p">.</span><span class="n">SetNode</span><span class="p">(</span><span class="n">_map</span><span class="p">);</span>
				<span class="n">_finish</span><span class="p">.</span><span class="n">SetNode</span><span class="p">(</span><span class="n">_map</span><span class="p">);</span>

				<span class="n">_start</span><span class="p">.</span><span class="n">_cur</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_map</span><span class="p">)</span><span class="o">+</span><span class="n">BuffSize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
				<span class="n">_finish</span><span class="p">.</span><span class="n">_cur</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_map</span><span class="p">)</span><span class="o">+</span><span class="n">BuffSize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

				<span class="o">*</span><span class="p">(</span><span class="n">_start</span><span class="p">.</span><span class="n">_cur</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
				<span class="o">--</span><span class="n">_start</span><span class="p">.</span><span class="n">_cur</span><span class="p">;</span>
				<span class="o">++</span><span class="n">_size</span><span class="p">;</span>
				<span class="n">_mapSize</span> <span class="o">=</span> <span class="n">newSize</span><span class="p">;</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">_mapSize</span> <span class="o">=</span> <span class="n">newSize</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="o">*</span><span class="p">(</span><span class="n">_start</span><span class="p">.</span><span class="n">_node</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="k">new</span> <span class="n">T</span><span class="p">[</span><span class="n">BuffSize</span><span class="p">];</span>
		<span class="n">_start</span><span class="p">.</span><span class="n">SetNode</span><span class="p">(</span><span class="n">_start</span><span class="p">.</span><span class="n">_node</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">_start</span><span class="p">.</span><span class="n">_cur</span> <span class="o">=</span> <span class="n">_start</span><span class="p">.</span><span class="n">_last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
		<span class="o">*</span><span class="p">(</span><span class="n">_start</span><span class="p">.</span><span class="n">_cur</span><span class="p">)</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
		<span class="o">++</span><span class="n">_size</span><span class="p">;</span>
	<span class="p">}</span>
<span class="nl">protected:</span>
	<span class="n">MapPointer</span> <span class="n">_map</span><span class="p">;</span>
	<span class="n">Iterator</span> <span class="n">_start</span><span class="p">;</span>
	<span class="n">Iterator</span> <span class="n">_finish</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">_mapSize</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">_size</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/algorithm-data-structure/'>Algorithm & Data Structure</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration" >C++</a> <a href="/tags/stl/" class="post-tag no-text-decoration" >STL</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How+deque+is+implemented+in+STL+-+Jacob+Lin&url=https%3A%2F%2Fjiahuanglin.xyz%2Fposts%2Fhow-deque-is-implemented-in-stl%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How+deque+is+implemented+in+STL+-+Jacob+Lin&u=https%3A%2F%2Fjiahuanglin.xyz%2Fposts%2Fhow-deque-is-implemented-in-stl%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fjiahuanglin.xyz%2Fposts%2Fhow-deque-is-implemented-in-stl%2F&text=How+deque+is+implemented+in+STL+-+Jacob+Lin" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/learning-java-annotations/">Learning Java annotations</a><li><a href="/posts/my-notes-of-reading-effective-c++/">My notes of reading effective C++</a><li><a href="/posts/how-to-shorten-the-url/">How to shorten the url</a><li><a href="/posts/floating-point-number-and-fixed-point-number/">Floating point numbers and fixed point numbers</a><li><a href="/posts/scanline-algorithm/">Scanline algorithm</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/go/">Go</a> <a class="post-tag" href="/tags/server/">server</a> <a class="post-tag" href="/tags/compiler/">compiler</a> <a class="post-tag" href="/tags/framework/">framework</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/graphics/">graphics</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/pub-sub-design-pattern/"><div class="card-body"> <em class="small" data-ts="1639622880" data-df="ll" > Dec 15, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pub-Sub design pattern</h3><div class="text-muted small"><p> Pub-Sub design pattern is usually known as Observer pattern. I personally like to refer this pattern as Pub-Sub which I think better captures the essence of this pattern. In GoFâ€™s book Design Patt...</p></div></div></a></div><div class="card"> <a href="/posts/decorator-design-pattern/"><div class="card-body"> <em class="small" data-ts="1639843920" data-df="ll" > Dec 18, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Decorator design pattern and Java I/O package</h3><div class="text-muted small"><p> The decorator pattern is a way to dynamically add functionality to an instance of an object at runtime. If we want to read data from file with Java, our code will look something like the follo...</p></div></div></a></div><div class="card"> <a href="/posts/chain-of-responsibility-design-pattern/"><div class="card-body"> <em class="small" data-ts="1639976460" data-df="ll" > Dec 20, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Chain of responsibility design pattern</h3><div class="text-muted small"><p> The chain of responsibility design pattern In compiler backend development, we usually will have to run multiple passes on the intermediate representation. Those passes including optimization ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/jvm-execution-engine-interpreters-and-jit/" class="btn btn-outline-primary" prompt="Older"><p>JVM execution engine - interpreter and JIT</p></a> <a href="/posts/decorator-design-pattern/" class="btn btn-outline-primary" prompt="Newer"><p>Decorator design pattern and Java I/O package</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> Â© 2022 <a href="https://github.com/jiahuanglin">Jiahuang(Jacob) Lin</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/go/">Go</a> <a class="post-tag" href="/tags/server/">server</a> <a class="post-tag" href="/tags/compiler/">compiler</a> <a class="post-tag" href="/tags/framework/">framework</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/graphics/">graphics</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
